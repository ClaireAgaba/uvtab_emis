{% extends 'base.html' %}

{% block content %}

<div style="width:100%; margin-bottom: 20px;">
  <a href="{% url 'report_list' %}" class="btn btn-secondary" style="float: left; margin-right: 10px;">
      &larr; Back to Reports
  </a>
</div>

<div class="min-h-screen bg-gray-50 px-4 py-8">
  <div class="max-w-2xl mx-auto">
    <!-- Header Section -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900">Generate Registration List</h1>
      <p class="mt-2 text-sm text-gray-600">Select parameters to generate the registration list</p>
    </div>

    <!-- Form Section -->
    <div class="bg-white rounded-lg shadow-sm p-6">
      <form method="post" class="space-y-6">
        {% csrf_token %}

        <!-- Assessment Center -->
        <div>
          <label for="center" class="block text-sm font-medium text-gray-700 mb-1">Assessment Center</label>
          <select name="center" id="center" required
            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded-md">
            <option value="">Select Assessment Center</option>
            {% for center in centers %}
              <option value="{{ center.id }}">{{ center.center_name }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- Occupation -->
        <div>
          <label for="occupation" class="block text-sm font-medium text-gray-700 mb-1">Occupation</label>
          <select name="occupation" id="occupation" required
            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded-md">
            <option value="">Select Occupation</option>
            {% for occupation in occupations %}
              <option value="{{ occupation.id }}">{{ occupation.name }}</option>
            {% endfor %}
          </select>
        </div>

        <!-- Registration Category -->
        <div>
          <label for="registration_category" class="block text-sm font-medium text-gray-700 mb-1">Registration Category</label>
          <select name="registration_category" id="registration_category" required
            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded-md"
            onchange="toggleLevelField()">
            <option value="">Select Registration Category</option>
            <option value="Formal">Formal</option>
            <option value="Informal">Informal</option>
            <option value="Modular">Modular</option>
          </select>
        </div>

        <!-- Level (shown only for formal/informal) -->
        <div id="level_field" style="display: none;">
          <div class="mb-4">
            <label for="level" class="block text-sm font-medium text-gray-700">Level</label>
            <select name="level" id="level" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
              {% for level in levels %}
                <option value="{{ level.id }}">{{ level.name }}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <!-- Assessment Month and Year -->
        <div class="grid grid-cols-2 gap-4">
          <div class="mb-4">
            <label for="assessment_month" class="block text-sm font-medium text-gray-700">Assessment Month</label>
            <select name="assessment_month" id="assessment_month" required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
              <option value="">Select Month</option>
              <option value="1">January</option>
              <option value="2">February</option>
              <option value="3">March</option>
              <option value="4">April</option>
              <option value="5">May</option>
              <option value="6">June</option>
              <option value="7">July</option>
              <option value="8">August</option>
              <option value="9">September</option>
              <option value="10">October</option>
              <option value="11">November</option>
              <option value="12">December</option>
            </select>
          </div>

          <div class="mb-4">
            <label for="assessment_year" class="block text-sm font-medium text-gray-700">Assessment Year</label>
            <select name="assessment_year" id="assessment_year" required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
              <option value="">Select Year</option>
              {% with current_year=2025 %}
                {% for year in ''|ljust:6 %}
                  <option value="{{ current_year|add:forloop.counter0|add:-5 }}">
                    {{ current_year|add:forloop.counter0|add:-5 }}
                  </option>
                {% endfor %}
              {% endwith %}
            </select>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="pt-4 border-t flex justify-end space-x-4">
          <a href="{% url 'report_list' %}" class="px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900">
            Cancel
          </a>
          <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
            Generate PDF
          </button>
        </div>
      </form>
    </div>
  {% load static %}
{% if pages %}
  {% for candidates in pages %}
    {% if forloop.first %}
      <!-- HEADER/INFO ONLY ON FIRST PAGE -->
      <div style="text-align: center;">
        <img src="{% static 'images/uvtab_logo.png' %}" alt="Logo" style="height: 60px;" />
        <h2>UGANDA VOCATIONAL AND TECHNICAL ASSESSMENT BOARD</h2>
        <h3>Registered Candidates for June 2025 Assessment</h3>
        <!-- Add other info as needed -->
      </div>
      <table style="width: 100%; border-collapse: collapse; margin-top: 30px;">
        <thead>
          <tr>
            <th>S/N</th>
            <th>Photo</th>
            <th>Reg No.</th>
            <th>Full Name</th>
            <th>Occupation</th>
            <th>Reg Type</th>
            <th>Signature</th>
          </tr>
        </thead>
        <tbody>
    {% else %}
      <table style="width: 100%; border-collapse: collapse; margin-top: 30px;">
        <tbody>
    {% endif %}
      {% for candidate in candidates %}
      <tr>
        <td>{{ forloop.parentloop.counter0|add:forloop.counter }}</td>
        <td>
          {% if candidate.photo %}
            <img src="{{ candidate.photo.url }}" alt="Photo" style="height: 60px;" />
          {% else %}
            N/A
          {% endif %}
        </td>
        <td>{{ candidate.reg_no }}</td>
        <td>{{ candidate.full_name }}</td>
        <td>{{ candidate.occupation }}</td>
        <td>{{ candidate.reg_type }}</td>
        <td><!-- Signature field, if any --></td>
      </tr>
      {% endfor %}
        </tbody>
      </table>
    {% if not forloop.last %}
      <div style="page-break-after: always;"></div>
    {% endif %}
  {% endfor %}
{% endif %}
{% endblock %}