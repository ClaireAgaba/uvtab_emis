{% extends 'base.html' %}

{% block content %}
<div class="max-w-6xl mx-auto mt-10 px-4">
  <!-- Header Section -->
  <div class="mb-8">
      <a href="{% url 'occupation_list' %}" class="text-blue-600 hover:underline mb-4 inline-block">
        ‚Üê Back to Occupations
      </a>
    <div class="flex justify-between items-center mt-4">
      <h1 class="text-3xl font-bold">{{ occupation.name }} <span class="text-gray-500">({{ occupation.code }})</span></h1>
      <a href="{% url 'occupation_edit' pk=occupation.pk %}" 
         class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
        </svg>
        Edit
      </a>
    </div>
  </div>

  <!-- General Info Card -->
  <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
    <h2 class="text-xl font-semibold mb-4">General Information</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <p class="text-gray-600">Category</p>
        <p class="text-lg">{{ occupation.category.name }}</p>
      </div>
      <div>
        <p class="text-gray-600">Structure Type</p>
        <p class="text-lg">{{ occupation.get_structure_type_display }}</p>
      </div>
    </div>
  </div>

  <!-- Tabs Navigation -->
  <div class="border-b border-gray-200">
    <ul class="flex -mb-px">
      {% for level in levels %}
        <li class="mr-6">
          <a class="tab-link py-4 px-1 border-b-2 {% if forloop.first %}border-blue-500 text-blue-600{% else %}border-transparent{% endif %} hover:border-gray-300" 
             href="#level-{{ level.id }}">{{ level.name }}</a>
        </li>
      {% endfor %}
    </ul>
  </div>

<!-- Level Content Tabs -->
{% for row in level_data %}
  <div id="level-{{ row.level.id }}" class="tab-content mt-8 bg-white rounded-lg shadow-sm p-6">
  <!--   <div class="flex justify-between items-center mb-6">
      <h2 class="text-xl font-semibold">{{ row.level.name }} Content</h2>
      {% if occupation.structure_type == 'modules' %}
        <a href="{% url 'add_module' row.level.id %}" class="inline-block bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
          + Add Module
        </a>
      {% else %}
        <a href="{% url 'add_paper' row.level.id %}" class="inline-block bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md">
          + Add Paper
        </a>
      {% endif %}
    </div> -->

    <div class="bg-gray-50 rounded-lg p-6">
      {% if occupation.structure_type == 'modules' %}
        {% if row.content %}
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for module in row.content %}
              <div class="bg-white p-4 rounded-md shadow-sm">
                <p class="font-medium">{{ module.name }}</p>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-gray-500 text-center py-8">No modules added yet.</p>
        {% endif %}
      {% else %}
        {% if row.content %}
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for paper in row.content %}
              <div class="bg-white p-4 rounded-md shadow-sm">
                <p class="font-medium">{{ paper.code }}</p>
                <p class="text-gray-600">{{ paper.name }}</p>
                <p class="text-sm text-gray-500 mt-1">{{ paper.get_type_display }}</p>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-gray-500 text-center py-8">No papers added yet.</p>
        {% endif %}
      {% endif %}
    </div>
  </div>
{% endfor %}
</div>

<!-- Audit Trail -->
<div class="text-xs text-gray-500 mt-4 text-right">
  <p>Created: {{ occupation.created_at|date:'Y-m-d H:i' }}{% if occupation.created_by %} by {{ occupation.created_by }}{% endif %}</p>
  <p>Last updated: {{ occupation.updated_at|date:'Y-m-d H:i' }}{% if occupation.updated_by %} by {{ occupation.updated_by }}{% endif %}</p>
</div>

<!-- Tab switching script -->
<script>
  const tabLinks = document.querySelectorAll(".tab-link");
  const tabContents = document.querySelectorAll(".tab-content");

  tabLinks.forEach(link => {
    link.addEventListener("click", (e) => {
      e.preventDefault();
      const target = link.getAttribute("href").substring(1);

      tabContents.forEach(tc => tc.style.display = "none");
      document.getElementById(target).style.display = "block";

      tabLinks.forEach(l => {
        l.classList.remove("border-blue-500", "text-blue-600");
        l.classList.add("border-transparent");
      });
      link.classList.remove("border-transparent");
      link.classList.add("border-blue-500", "text-blue-600");
    });
  });

  // Initialize first tab
  tabContents.forEach((tc, i) => tc.style.display = i === 0 ? "block" : "none");
</script>
{% endblock %}

