{% extends 'base.html' %}

{% block content %}
<div class="max-w-7xl mx-auto mt-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold">Candidates</h1>
    <a href="{% url 'candidate_create' %}" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">+ Create Candidate</a>
  </div>

  <!-- Candidate Table -->
  <div class="mb-2 text-sm text-gray-600 flex justify-between items-center">
  <span>
    {{ page_obj.start_index }}-{{ page_obj.end_index }} / {{ paginator.count }}
  </span>
  <span>
    {% if page_obj.has_previous %}
      <a href="?{% if request.GET %}{{ request.GET.urlencode|safe }}&{% endif %}page={{ page_obj.previous_page_number }}" class="inline-block px-2">&#60;</a>
    {% endif %}
    {% if page_obj.has_next %}
      <a href="?{% if request.GET %}{{ request.GET.urlencode|safe }}&{% endif %}page={{ page_obj.next_page_number }}" class="inline-block px-2">&#62;</a>
    {% endif %}
  </span>
</div>

<div class="overflow-x-auto bg-white shadow rounded">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">Reg No</th>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Full Name</th>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Occupation</th>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Reg. Category</th>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Center</th>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">Actions</th>
        </tr>
        <tr>
          <form method="get">
            <th class="px-2 py-1">
              <input type="text" name="reg_number" value="{{ request.GET.reg_number }}" placeholder="Search Reg No" class="border px-2 py-1 w-full" />
            </th>
            <th class="px-2 py-1">
              <input type="text" name="search" value="{{ request.GET.search }}" placeholder="Search Name" class="border px-2 py-1 w-full" />
            </th>
            <th class="px-2 py-1">
              <select name="occupation" class="border px-2 py-1 w-full">
                <option value="">All Occupations</option>
                {% for occupation in occupations %}
                  <option value="{{ occupation.id }}" {% if request.GET.occupation == occupation.id|stringformat:"s" %}selected{% endif %}>{{ occupation.name }}</option>
                {% endfor %}
              </select>
            </th>
            <th class="px-2 py-1">
              <select name="registration_category" class="border px-2 py-1 w-full">
                <option value="">All Categories</option>
                <option value="formal" {% if request.GET.registration_category == 'formal' %}selected{% endif %}>Formal</option>
                <option value="modular" {% if request.GET.registration_category == 'modular' %}selected{% endif %}>Modular</option>
                <option value="informal" {% if request.GET.registration_category == 'informal' %}selected{% endif %}>Informal</option>
              </select>
            </th>
            <th class="px-2 py-1">
              <select name="assessment_center" class="border px-2 py-1 w-full">
                <option value="">All Centers</option>
                {% for center in centers %}
                  <option value="{{ center.id }}" {% if request.GET.assessment_center == center.id|stringformat:"s" %}selected{% endif %}>{{ center.center_name }}</option>
                {% endfor %}
              </select>
            </th>
            <th class="px-2 py-1">
              <button type="submit" class="bg-blue-500 text-white px-3 py-1 rounded">Filter</button>
            </th>
          </form>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        {% for candidate in candidates %}
        <tr>
          <td class="px-4 py-2 whitespace-nowrap">{{ candidate.reg_number }}</td>
          <td class="px-4 py-2">{{ candidate.full_name }}</td>
          <td class="px-4 py-2">{{ candidate.occupation.name }}</td>
          <td class="px-4 py-2">{{ candidate.get_registration_category_display }}</td>
          <td class="px-4 py-2 whitespace-nowrap">
            {{ candidate.assessment_center.center_name|default:"â€”" }}
          </td>
          <td class="px-4 py-2">
            <a href="{% url 'candidate_view' candidate.id %}" class="text-blue-600 hover:underline">View</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="px-4 py-4 text-center text-gray-500">No candidates found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
